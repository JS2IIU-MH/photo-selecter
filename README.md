# 写真選定アプリ「picsel」

## 概要
「picsel」は、写真フォルダ内の画像を効率よくプレビューし、良い写真だけを選んでコピー・削除できるWindows専用のデスクトップアプリです。TkinterによるシンプルなUIと、Pillow/HEIF/OpenCVによる画像処理を組み合わせ、素早い選別作業をサポートします。

## 主な機能
- 指定フォルダ内の画像（jpg, png, heic）を1枚ずつプレビュー
- キー操作で「良い写真」をコピー、不要写真を削除リストに追加
- ぼやけ判定（ラプラシアン分散法）で自動的に「ぼやけ」画像を検出・ラベル表示
- 画像中央部の一部を拡大し、右下隅にオーバーレイ表示
- 操作キーや拡大範囲・倍率・ぼやけ閾値・ウィンドウサイズなどを`setting.ini`でカスタマイズ可能
- 削除リストはjson形式で一時保存、終了時にまとめて削除可能
- フォルダ選択ダイアログは直近の履歴を記憶
- 画像のプリフェッチによる高速表示
- Windows専用

## 画面構成・操作方法
- 上部：画像プレビューエリア（画像中央部の拡大枠・ぼやけラベル付き）
- 下部：操作ボタン（参照先選択／保存先選択／削除して終了／削除せず終了）
- キーボード操作：
    - Kキー：良い写真を保存先にコピーし、次の写真へ
    - →キー：次の写真へ
    - ←キー：前の写真へ
    - Dキー：削除リストに追加し、次の写真へ
    - キー割り当ては`setting.ini`で変更可能

## ぼやけ判定について
- OpenCVのラプラシアン分散法で画像のシャープさを数値化し、閾値未満なら「ぼやけ」と判定
- 閾値は`setting.ini`で調整可能
- ぼやけ画像には左上に「ぼやけ」ラベルを重ねて表示

## 拡大表示について
- 画像中央から縦横±10ピクセル（デフォルト）の範囲を切り出し、10倍（デフォルト）に拡大
- 拡大範囲・倍率は`setting.ini`で変更可能
- 元画像上にも拡大範囲を赤枠で表示

## 設定ファイル（setting.ini）
- アプリと同じフォルダに配置
- ウィンドウサイズ、キー割り当て、拡大範囲・倍率、ぼやけ閾値、フォルダ履歴などを保存
- exe化（pyinstaller）時も同じ階層に配置

## setting.iniの書き方と各項目の説明

`setting.ini`はアプリの動作やUI、キー割り当てなどを柔軟にカスタマイズできる設定ファイルです。テキストエディタで編集できます。

### サンプル
```
[window]
width = 1024
height = 768

[keys]
copy = K
next = Right
prev = Left
delete = D

[zoom]
range = 10
scale = 10

[blur]
threshold = 100.0

[history]
last_open_dir = C:/Users/YourName/Pictures
last_save_dir = C:/Users/YourName/Pictures/Selected
```

### 各項目の意味
- `[window]` … アプリウィンドウの初期サイズ
    - `width`：横幅（ピクセル）
    - `height`：高さ（ピクセル）
- `[keys]` … 操作キーの割り当て
    - `copy`：良い写真をコピーするキー（例：K）
    - `next`：次の写真へ進むキー（例：Right）
    - `prev`：前の写真に戻るキー（例：Left）
    - `delete`：削除リストに追加するキー（例：D）
    - キー名はTkinterのキー名に準拠（例：A, B, C, Right, Left, Up, Down など）
- `[zoom]` … 拡大表示の設定
    - `range`：拡大する範囲（画像中央から±ピクセル数）
    - `scale`：拡大率（何倍に拡大するか）
- `[blur]` … ぼやけ判定の閾値
    - `threshold`：ラプラシアン分散値の閾値（小さいほど厳しく判定）
- `[history]` … フォルダ選択ダイアログの初期値
    - `last_open_dir`：前回参照したフォルダのパス
    - `last_save_dir`：前回保存先にしたフォルダのパス

### 注意点
- ファイルはUTF-8で保存してください
- exe化した場合も`setting.ini`はexeと同じフォルダに配置してください
- 設定を変更した場合はアプリを再起動してください

## 削除リスト・一時ファイル
- Dキーで削除対象にしたファイルは、json形式で元フォルダに`delete_list.json`として保存
- 「削除して終了」ボタンで一括削除、「削除せず終了」ボタンで削除せず終了

## ソースコード解説
- `main.py`：アプリ本体。TkinterによるUI、画像表示・リサイズ、ぼやけ判定、拡大表示、ファイル操作、設定管理など全機能を実装
    - `AppConfig`クラス：setting.iniの読み書き、各種設定値の管理
    - `PhotoSelectorApp`クラス：Tkウィンドウ、画像表示、ボタン・キーイベント、画像リスト管理、削除リスト管理、プリフェッチなど
    - 画像表示はFrame内Labelに固定し、ウィンドウリサイズやボタン領域との重なりを防止
    - 画像の拡大枠・ぼやけラベルはPillowで描画
    - HEIC画像はpillow-heifで対応
    - 主要な関数にはコメントあり
- `setting.ini`：初期設定例を同梱
- `requirements.txt`：必要なPythonパッケージ一覧

## インストール・実行方法
1. Python 3.8以降をインストール
2. 必要パッケージをインストール
   ```
   pip install -r requirements.txt
   ```
3. アプリを起動
   ```
   python ./src/main.py
   ```
4. exe化する場合はpyinstaller等を利用

## 注意事項
- Windows専用です
- heic画像の表示にはpillow-heifが必要です
- 画像・ファイル操作は自己責任で行ってください

---

ご質問・ご要望はmemo.mdに追記、またはIssue等でお知らせください。
